{% extends 'base.html' %}
{% load static %}
{% block content %}


    {% if user.username == locality.name %}
    <div class="locality-home-body">
        <h1 class="locality-home-header locality_name">{{locality.name}}</h1>

        <form action="/form/" method="POST" class="generateButton-form">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary btn-lg generateButton" value = "{{locality}}" name="generateButton">Generate New Project Analysis</button>
        </form>
        
        {% if simulations %}
            <div class="locality-summary">
                <table class="locality-summary-table">
                    <tr>
                        <td>
                            <h4>Total Revenue Share Revenue</h4>
                        </td>
                        <td>
                            <h4><span class="dollar_value">{{total_rs_revenue}}</span></h4>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h4>Total M&T Revenue</h4>
                        </td>
                        <td>
                            <h4><span class="dollar_value">{{total_mt_revenue}}</span></h4>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <h4>Increase in Revenue from Revenue Share</h4>
                        </td>
                        <td>
                            <h4><span class="dollar_value difference">{{difference}}</span></h4>
                        </td>
                    </tr>
                
                </table>
                <!-- <h2>Total Revenue Share Income from all Analyses: </h2>
                <h2>Total M&T Income from all Analyses: </h2>
                <h2>Increase in income from Revenue Share: </h2> -->
            </div>
            {% for simulation in simulations %}
                {% if forloop.first %}
                        <div class="row locality-row">
                {% endif %}
                
                <div class="col-xl-4 col-md-6 col-sm-12">
                    <div class="card simulation-card text-center">
                        <div class="card-body">
                            <table class="card-table table-striped">
                                <tr class="card-table-row">
                                    <td>
                                        <strong>Initial Year</strong>
                                    </td>
                                    <td class="card-table-value">
                                        {{simulation.initial_year}}
                                    </td>
                                </tr>
                                <tr class="card-table-row odd">
                                    <td>
                                        <strong>Initial Investment</strong>
                                    </td>
                                    <td class="card-table-value">
                                        <span class="dollar_value">{{simulation.initial_investment}}</span>
                                    </td>
                                </tr>
                                <tr class="card-table-row">
                                    <td>
                                        <strong>Project Size</strong>
                                    </td>
                                    <td class="card-table-value">
                                        {{simulation.project_size}} MW
                                    </td>
                                </tr>
                                <tr class="card-table-row">
                                    <td>
                                        <strong>Dominion or APCO?</strong>
                                    </td>
                                    <td class="card-table-value">
                                        {{simulation.dominion_or_apco}}
                                    </td>
                                </tr>
                                <tr class="odd card-table-row">
                                    <td>
                                        <strong>Revenue Share Revenue</strong>
                                    </td>
                                    <td class="card-table-value">
                                        <span class="dollar_value">{% get_totals simulation.calculations.tot_rs %}</span>
                                    </td>
                                </tr>
                                <tr class="card-table-row">
                                    <td>
                                        <strong>M&T Revenue</strong>
                                    </td>
                                    <td class="card-table-value">
                                        <span class="dollar_value">{% get_totals simulation.calculations.tot_mt %}</span>
                                    </td>
                                </tr>
                                <tr class="odd card-table-row">
                                    <td>
                                        <strong>Difference</strong>
                                    </td>
                                    <td class="card-table-value">
                                        <span class="dollar_value difference">{% subtract simulation.calculations.tot_rs simulation.calculations.tot_mt %}</span>
                                    </td>
                                </tr>
                            </table>
                            <!-- <p class="card-text">Initial Year: {{simulation.initial_year}}</p>
                            <p class="card-text">Initial Investment: $<span class="comma_value">{{simulation.initial_investment}}</span></p>
                            <p class="card-text">Project Size: {{simulation.project_size}} MW</p>
                            <p>Total Revenue Share: $<span class="comma_value">{% get_totals simulation.calculations.tot_rs %}</span></p>
                            <p>Total M&T: $<span class="comma_value">{% get_totals simulation.calculations.tot_mt %}</span></p> -->
                            <div class="analysis-buttons">
                                <form action="/locality-{{simulation.locality.name}}/{{simulation.id}}/" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="simulation_id" value ="{{simulation.id}}">
                                    <button type="submit" class="btn btn-primary btn-md view-button" name = "viewButton">View Analysis</button>
                                </form>
                                <form action="/locality-{{simulation.locality.name}}/" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="simulation_id" value ="{{simulation.id}}">
                                    <button type="submit" class="btn btn-md btn-danger delete-button" name = "deleteButton">Delete Analysis</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
            </div>

                   
        <!--
            Display as Table and have update button on bottom
        -->
        <div class="locality-info">
            <h2> Locality Parameters for Calculations</h2>
            <table class="table-striped locality-info-table">
                <thead>
                    <tr>
                        <td>
                            <strong>Parameter</strong>
                        </td>
                        <td class="value">
                            <strong>Value</strong>
                        </td>
                    </tr>
                </thead>
                <tr>
                    <td>
                        Revenue Share Rate
                    </td>
                    <td class="dollar_value value">
                        {{locality.revenue_share_rate}} /MW
                    </td>
                </tr>
                <tr>
                    <td>
                        Discount Rate
                    </td>
                    <td class="value">
                        {{locality.discount_rate}}%
                    </td>
                </tr>
                <tr>
                    <td>
                        M&T Tax Rate
                    </td>
                    <td class="value">
                        ${{locality.mt_tax_rate}} / $100 Assessed Value
                    </td>
                </tr>
                <tr>
                    <td>
                        Real Property Rate
                    </td>
                    <td class="value">
                        ${{locality.real_property_rate}} / $100 Assessed Value
                        <!-- <span class="dollar_value">{{locality.real_property_rate}}</span>/$100 Assessed Value -->
                    </td>
                </tr>
                <tr>
                    <td>
                        Assessment Ratio
                    </td>
                    <td class="value">
                        {{locality.assessment_ratio}}%
                    </td>
                </tr>
                <!-- <tr>
                    <td>
                        Depreciation Schedule
                    </td>
                    <td>
                        {{locality.local_depreciation}}
                    </td>
                </tr> -->
                <tr>
                    <td>
                        <strong>Composite Index Parameters</strong>
                    </td>
                    <td>
                    </td>
                </tr>
                <tr>
                    <td>
                        Local True Value
                    </td>
                    <td class="dollar_value value">
                        {{locality.baseline_true_value}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Adjusted Gross Income
                    </td>
                    <td class="dollar_value value">
                        {{locality.adj_gross_income}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Taxable Retail Sales
                    </td>
                    <td class="dollar_value value">
                        {{locality.taxable_retail_sales}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Population
                    </td>
                    <td class="comma_value value">
                        {{locality.population}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Average Daily Student Membership (ADM)
                    </td>
                    <td class="comma_value value">
                        {{locality.adm}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Required Local Matching
                    </td>
                    <td class="dollar_value value">
                        {{locality.required_local_matching}}
                    </td>
                </tr>
                <tr>
                    <td>
                        Education Budget Escalator
                    </td>
                    <td class="value">
                        {{locality.budget_escalator}}%
                    </td>
                </tr>
                <tr>
                    <td>
                        Years Between Assessment
                    </td>
                    <td class="value">
                        {{locality.years_between_assessment}}
                    </td>
                </tr>
            </table>
        </div>
        
        <form method="POST" action="update-locality-parameters/" class="update-form">
            {% csrf_token %}

            <!-- <label for="discount_rate">Discount Rate %</label>
            <input id="discount_rate" type="number" name="discount_rate" value="{{ locality.discount_rate }}"><br>
            <label for="discount_rate">Revenue Share Rate $/MW</label>
            <input id="revenue_share_rate" type="number" name="revenue_share_rate" value="{{ locality.revenue_share_rate }}"><br> -->
            <input class="btn btn-primary btn-lg" type="submit" value="Update Locality Parameters">
        </form>

        {% else %}
                <h2>Please Click to Generate a new Analysis</h2>
                <!-- <form action="/form/" method="POST" class="generateButton-form">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary btn-lg generateButton" value = "{{locality}}" name="generateButton">Generate New Model</button>
                </form> -->
        {% endif %}
    </div>

    
    {% else %}
        <div class="locality-error-message">
            <h2>Your are not logged in as <span class="locality_name">{{locality.name}}</span></h2>
            <br>
            <h2>Please Login to <span class="locality_name">{{locality.name}}</span>'s Account</h2>
        </div>
    {% endif %}
{% endblock %}